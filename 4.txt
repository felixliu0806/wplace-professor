// content_script_silent_timer.js
(function() {
  const dialog = document.querySelector('dialog.modal');
  if (!dialog) return;

  // 保存原始 showModal 方法
  const originalShowModal = dialog.showModal.bind(dialog);

  // hook showModal
  dialog.showModal = function(...args) {
    if (dialog.hasAttribute('data-silent')) {
      console.log('Silent mode: preventing modal display');
      return; // 插件触发，不显示弹窗
    }
    return originalShowModal(...args); // 页面触发，正常显示
  };

  // 核心函数：插件触发 Share + 定时关闭
  function openShareSilentlyWithTimer(delay = 500) {
    // 1️⃣ 标记 silent
    dialog.setAttribute('data-silent', '');

    // 2️⃣ 点击页面按钮触发 Share
    const shareBtn = document.querySelector('.share-btn');
    if (!shareBtn) return;
    shareBtn.click();

    // 3️⃣ 定时关闭 dialog（ms）
    setTimeout(() => {
      dialog.removeAttribute('data-silent');
      dialog.removeAttribute('open');
      console.log('Dialog closed after timer');
    }, delay);
  }

  // 暴露给插件按钮调用
  window.openShareSilentlyWithTimer = openShareSilentlyWithTimer;

})();
